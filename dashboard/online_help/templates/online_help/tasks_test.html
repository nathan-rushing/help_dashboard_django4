{% extends 'online_help/base.html' %}
{% block content %}
{% load static %}

<link rel="stylesheet" href="{% static 'css/doc_sec_sub_list.css' %}">
<!-- <link href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css" rel="stylesheet"> -->

<!-- Breadcrumbs -->
<p>
    <a href="{% url 'online_help:tasks_test' %}" class="hover-link"> All Tasks </a>
    â€º
</p>

<div class="container mt-4">
    <div class="p-3 d-flex justify-content-between align-items-start gap-3" style="position: sticky; top: 30px; z-index: 1000;">
        <input type="text" id="searchInput" class="form-control w-75" placeholder="Search sections or subsections..." onkeyup="filterContent()">
        <a href="{% url 'online_help:document_list' %}" class="btn text-white" style="background-color: #0747a6;">Radiant Documentation</a>
        <a href="{% url 'online_help:assign_task' %}" class="btn text-white" style="background-color: #0747a6;">Assign</a>

    </div>

    <div class="row mt-4">
        {% for document, tasks in grouped_tasks.items %}
        <div class="col-md-6 mb-4">
            <div class="bg-light rounded scroll-box shadow-sm">
                <div class="p-3 text-white text-center" style="background-color: #0747a6;">
                    {% if document %}
                        <a href="{% url 'online_help:document_sections' document.id %}" class="hover-link text-white">{{ document.name }}</a>
                    {% else %}
                        <span>No Document</span>
                    {% endif %}
                </div>
                <div class="p-2">
                    <table class="table table-bordered">
                        <thead class="table-light">
                            <tr>
                                <th style="border: 1px solid #444; padding: 8px;">Section</th>
                                <th style="border: 1px solid #444; padding: 8px;">Subsection</th>
                                <th style="border: 1px solid #444; padding: 8px;">Writer</th>
                                <th style="border: 1px solid #444; padding: 8px;">SME</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for task in tasks %}
                            <tr>
                                <td style="background-color: {{ task.subsection.color }};">
                                    {% if task.subsection.section %}
                                        <a href="{% url 'online_help:section_subsections' task.subsection.section.id %}" class="hover-link">
                                            {{ task.subsection.section.name }}
                                        </a>
                                    {% else %}
                                        No section
                                    {% endif %}
                                </td>
                                <td style="background-color: {{ task.subsection.color }};">
                                    {% if task.subsection %}
                                        <a href="{% url 'online_help:subsection_details' task.subsection.id %}" class="hover-link">
                                            {{ task.subsection.name }}
                                        </a>
                                    {% else %}
                                        No subsection
                                    {% endif %}
                                </td>
                                <td style="background-color: {{ task.subsection.color }};">
                                    {% if task.writers.all %}
                                        {% for writer in task.writers.all %}
                                            {{ writer.name }}{% if not forloop.last %}, {% endif %}
                                        {% endfor %}
                                    {% else %}
                                        Unassigned
                                    {% endif %}
                                </td>
                                <td style="background-color: {{ task.subsection.color }};">{{ task.sme|default:"Not assigned" }}</td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
        {% endfor %}
    </div>

</div>





<script>
function filterContent() {
    const input = document.getElementById("searchInput").value.toLowerCase();
    const containers = document.querySelectorAll(".scroll-box");


    containers.forEach(container => {
        const heading = container.querySelector("h5, p");
        const table = container.querySelector("table");
        let tableHasMatch = false;

        // Check heading text
        const headingMatch = heading && heading.innerText.toLowerCase().includes(input);

        // Check table rows
        if (table) {
            const rows = table.querySelectorAll("tbody tr");
            rows.forEach(row => {
                const text = row.innerText.toLowerCase();
                const match = text.includes(input);
                row.style.display = match ? "" : "none";
                if (match) tableHasMatch = true;
            });
        }

        // Show/hide container based on matches
        if (headingMatch || tableHasMatch) {
            container.style.display = "";
        } else {
            container.style.display = "none";
        }
    });
}
</script>

{% endblock %}
