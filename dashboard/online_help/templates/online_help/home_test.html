{% extends 'online_help/base.html' %}
{% block content %}
{% load static custom_filters %}

<link rel="stylesheet" href="{% static 'css/doc_sec_sub_list.css' %}">
<h1>Radiant Help Dashboard</h1>

<!-- Flex container for Version and Download Excel -->
<div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">


  <!-- Download Excel Button -->
  <div>
    <a href="" class="btn btn-success">
      ðŸ“¥ Download Excel
    </a>
  </div>

</div>

<div class="p-3" style="position: sticky; top: 30px; z-index: 1000;">
    <input type="text" id="searchInput" class="form-control" placeholder="Search sections or subsections..." onkeyup="filterContent()">
</div>

<div class="container mt-4">
    <div class="row">
        {% for writer in writers %}
            <div class="col-md-6 mb-4">
                <div class="bg-light rounded scroll-box shadow-sm">
                  <div class="p-3 text-white text-center {{ writer_color_classes|get_item:writer.pk }}">
                        <p class="m-0">
                            <a href="" class="hover-link">{{ writer.name }}</a>
                        </p>
                    </div>
                    <div class="p-2">
                        {% with writer_tasks_grouped|get_item:writer.pk as documents %}
                            {% if documents %}
                                {% for document, tasks in documents.items %}
                                    <h5>{{ document }}</h5>
                                    <table class="table table-bordered mb-3">
                                        <thead class="thead-light">
                                            <tr>
                                                <th>Section</th>
                                                <th>Sub</th>
                                                <!-- <th>Color</th> -->
                                                <th>Completion</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            {% for tk in tasks %}
                                                <tr>
                                                    <td style="background-color: {{ tk.color }}; ">{{ tk.subsection.section.name }}</td>
                                                    <td style="background-color: {{ tk.color }}; ">
                                                        <a href="{% url 'online_help:view_subsection' tk.subsection.id %}" class="hover-link">
                                                            {{ tk.subsection.name }}
                                                        </a>
                                                    </td>
                                                    <td style="background-color: {{ tk.color }}; ">{{ tk.subsection.completion }}</td>
                                                </tr>
                                            {% endfor %}
                                        </tbody>
                                    </table>
                                {% endfor %}
                            {% else %}
                                <p>No tasks assigned.</p>
                            {% endif %}
                        {% endwith %}
                    </div>
                </div>
            </div>
        {% endfor %}
    </div>
</div>


<script>
function filterContent() {
    const input = document.getElementById("searchInput").value.toLowerCase();
    const headings = document.querySelectorAll("h5");
    const tables = document.querySelectorAll("table");

    headings.forEach((heading, index) => {
        const table = tables[index];
        const rows = table.querySelectorAll("tbody tr");
        let tableHasMatch = false;

        const headingMatch = heading.innerText.toLowerCase().includes(input);

        rows.forEach(row => {
            const text = row.innerText.toLowerCase();
            const match = text.includes(input);
            row.style.display = match ? "" : "none";
            if (match) tableHasMatch = true;
        });

        heading.style.display = headingMatch || tableHasMatch ? "" : "none";
        table.style.display = tableHasMatch ? "" : "none";
    });
}
</script>

{% endblock %}
